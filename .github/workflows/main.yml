name: Tag test
on:
  workflow_dispatch:
    inputs:
      commit_id:
        type: string
        required: false

env:
  environment: "DEV"

permissions: write-all

jobs:
  test-tag:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    environment: ${{ inputs.environment_from_input }}
    steps:
      - name: checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.commit_id }}

      # - name: Get short SHA
      #   run: |
      #     echo "SHORT_SHA=${GITHUB_SHA:0:7}" >> $GITHUB_ENV

      - name: Check if tag exists
        uses: mukunku/tag-exists-action@v1.6.0
        id: check-tag
        with:
          tag: "deploy__${{ inputs.environment_from_input }}__${{ inputs.environment_from_input }}"

      - name: Create Deployment Tag
        if: steps.check-tag.outputs.exists == 'false'
        uses: mathieudutour/github-tag-action@v6.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          custom_tag: "deploy__${{ inputs.environment_from_input }}__${{ inputs.environment_from_input }}"
          tag_prefix: ""
      # - name: warning
      #   if: steps.check-tag.outputs.exists == 'true'
      #   run: |
      #     echo "::warning title=WARN::Tag already exits"

      # - name: Find Tag
      #   id: tagger
      #   continue-on-error: true
      #   uses: jimschubert/query-tag-action@v1
      #   with:
      #     include: "deploy__QA__V1.0.0*"
      #     commit-ish: "HEAD"

      # - name: testing
      #   if: ${{ vars.IS_JIRA_CHECK_ENABLED == 'true' && steps.tagger.outcome == 'success'}}
      #   run: |
      #     echo "status : ${{ steps.tagger.outcome}}"
